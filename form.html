<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scoob Delivery</title>
  <link rel="icon" href="favw.png" type="image/png" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="logo">
      <img src="favw.png" alt="Logo" width="80" />
      <span>scoob</span>
    </div>
  </header>

  <div id="formPage" style="display:flex;justify-content:center;align-items:center;min-height:100vh;">
    <div class="form-container">
      <h3 style="text-align:center;color:white;">delivery details</h3>

      <form id="scoobForm">
        <input type="hidden" name="access_key" value="8e398483-cdb4-4b40-a7fd-bc10b07a0d06" />

        <!-- Hidden textareas must include name -->
        <textarea id="restaurantList" name="restaurantList" style="display:none;"></textarea>
        <textarea id="cartItemsVisible" name="cartItemsVisible" style="display:none;"></textarea>
        <textarea id="totalVisible" name="totalVisible" style="display:none;"></textarea>

        <div class="inputs">
          <input type="hidden" name="cartItems" id="cartItemsInput" />
          <input type="hidden" name="total" id="totalInput" />
          <input type="hidden" name="from" id="fromInput" />
          <textarea style="display:none;" id="userInputField" name="userInput"></textarea>

          <input type="text" name="name" placeholder="name" required style="width:340px" /><br />
          <input type="tel" name="phone" pattern="\+?[0-9]{10,}" placeholder="phone #" required style="width:340px" /><br />
          <textarea name="missingItem" rows="3" placeholder="add written order" style="width:340px"></textarea><br />
          <input name="deliverytime" placeholder="Delivered ASAP or At --:--" required style="width:340px" /><br />
        </div>

        <button type="button" id="autoLocate" name="Auto-Locate">
          <pre>Auto-Locate    or   Use Map Below</pre>
        </button>

        <div id="map" style="height:300px;margin-bottom:20px;"></div>

        <input type="text" id="coordinates" name="coordinates" placeholder="location appears here. locating error? Use googlemapsüëÄ" required style="width:345px;color:black;" />

        <div class="inputsColor">
          <hr />
          <textarea name="download" placeholder="order: movies | series | games/apps" style="width:150px;height:30px;background:black;"></textarea>
          <input class="custom-placeholder" type="text" name="transfer" placeholder="via: cd | flash | xender | usb" style="max-width:250px;" /><br />
        </div>

        <input type="checkbox" name="botcheck" class="hidden" style="display:none;" />

        <button type="submit" id="submitOrder">Submit Order</button>
      </form>

      <div id="thankYouMessage" style="display:none;text-align:center;color:white;background:#111;padding:20px;border-radius:10px;margin-top:20px;">
        <h3>Thank you!</h3>
        <p>Soon Scoob will contact you.</p>
        <p>Need help? <strong>0782 887 188</strong></p>
      </div>
    </div>
  </div>

  <!-- Leaflet Scripts -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <script>
    document.getElementById("scoobForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);
      const submitBtn = document.getElementById("submitOrder");

      submitBtn.disabled = true;
      submitBtn.textContent = "Sending...";

      try {
        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          body: formData,
        });

        if (response.ok) {
          form.style.display = "none";
          document.getElementById("thankYouMessage").style.display = "block";
        } else {
          alert("Network error. Please try again or contact Scoob - 0782887188");
          submitBtn.disabled = false;
          submitBtn.textContent = "Submit Order";
        }
      } catch (error) {
        alert("Connection error. Check your internet and try again.");
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit Order";
      }
    });
  </script>

  <script>
    window.addEventListener("load", function () {
      const cartItems = sessionStorage.getItem("cartItems") || "";
      const totalAmount = sessionStorage.getItem("totalAmount") || "";
      const from = sessionStorage.getItem("from") || "";
      const userInputs = sessionStorage.getItem("userInputs") || "";

      document.getElementById("cartItemsInput").value = cartItems;
      document.getElementById("totalInput").value = totalAmount;
      document.getElementById("fromInput").value = from;
      document.getElementById("userInputField").value = userInputs;

      document.getElementById("cartItemsVisible").value = cartItems;
      document.getElementById("totalVisible").value = totalAmount;
      document.getElementById("restaurantList").value = from;
    });
  </script>

  <script>
    let marker;

    const map = L.map("map").setView([-3.375, 36.6899], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    function setMarker(latlng) {
      if (marker) map.removeLayer(marker);
      marker = L.marker(latlng).addTo(map);
      document.getElementById("coordinates").value = `Latitude: ${latlng.lat.toFixed(5)}, Longitude: ${latlng.lng.toFixed(5)}`;
    }

    map.on("click", (e) => setMarker(e.latlng));
document.getElementById("autoLocate").addEventListener("click", () => {
  const btn = document.getElementById("autoLocate");

  // Loading state
  btn.disabled = true;
  btn.style.opacity = "0.6";
  btn.innerHTML = "<pre>Locating... ‚è≥</pre>";

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const latlng = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        };

        map.setView(latlng, 16);
        setMarker(latlng);

        // Restore button
        btn.disabled = false;
        btn.style.opacity = "1";
        btn.innerHTML = "<pre>Auto-Locate    or   Use Map Below</pre>";
      },
      (error) => {
        let message = "";

        switch (error.code) {
          case error.PERMISSION_DENIED:
            message = "Please turn location first or Use map manually.";
            break;

          case error.POSITION_UNAVAILABLE:
            message = "Location unavailable. Please turn on GPS and try again.";
            break;

          case error.TIMEOUT:
            message = "Location timed out. Please turn on GPS and try again.";
            break;

          default:
            message = "Unable to detect location. Please turn on GPS or use the map manually.";
            break;
        }

        alert(message);

        // Restore button
        btn.disabled = false;
        btn.style.opacity = "1";
        btn.innerHTML = "<pre>Auto-Locate    or   Use Map Below</pre>";
      },
      {
        enableHighAccuracy: true,
        timeout: 15000,
        maximumAge: 0
      }
    );
  } else {
    alert("Your device does not support auto-locate. Use the map manually.");

    // Restore button
    btn.disabled = false;
    btn.style.opacity = "1";
    btn.innerHTML = "<pre>Auto-Locate    or   Use Map Below</pre>";
  }
});

    L.Control.geocoder({ defaultMarkGeocode: false })
      .on("markgeocode", function (e) {
        map.setView(e.geocode.center, 15);
        setMarker(e.geocode.center);
      })
      .addTo(map);

    window.addEventListener("load", () => map.invalidateSize());
  </script>
</body>
</html>


